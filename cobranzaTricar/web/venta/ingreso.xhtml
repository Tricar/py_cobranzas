<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:o="http://omnifaces.org/ui"
                template="./../views/template.xhtml">

    <ui:define name="content">
        <h2>Solicitud de Crédito Directo</h2>
        <f:view afterPhase="#{anexoBean.phaseListener}">
            <h:form prependId="false ">
                <p:growl id="msg12" />
                <p:panelGrid columns="2">
                    <p:autoComplete id="cliente" value="#{creditoBean.credito.anexo}"
                                    completeMethod="#{anexoBean.filtrarCliente}" var="cliente"
                                    itemLabel="#{cliente.nombres}" itemValue="#{cliente}" 
                                    required="true" requiredMessage="Ingrese cliente">
                        <o:converter converterId="omnifaces.ListConverter" list="#{anexoBean.anexos}"/>
                        <p:ajax event="mousemove" listener="#{creditoBean.precioModeloCredito()}"/>
                        <p:ajax event="itemSelect" listener="#{creditoBean.cargarIngreso(creditoBean.credito.anexo)}" update="@form"/>
                        <p:ajax event="itemSelect" listener="#{anexoBean.handleSelect}" />
                        <p:ajax event="itemUnselect" listener="#{anexoBean.handleUnSelect}" />
                    </p:autoComplete>
                </p:panelGrid>
                <p:accordionPanel>
                    <p:tab title="Ingresos">
                        <p:dataTable var="ocups" value="#{creditoBean.ocupsxanexo}" 
                                     emptyMessage="No hay nada para mostrar">
                            <p:column headerText="Descripción">
                                <h:outputText value="#{ocups.descripcion}" />
                            </p:column>
                            <p:column headerText="Empresa">
                                <h:outputText value="#{ocups.empresa}" />
                            </p:column>
                            <p:column headerText="Monto">
                                <h:outputText value="#{ocups.montoin}" />
                            </p:column>
                            <p:column headerText="Operaciones">                        
                                <p:commandButton oncomplete="dlginsertar.show()" icon="b-ver">
                                    <f:setPropertyActionListener target="#{creditoBean.objocup}" value="#{ocups}" />
                                </p:commandButton>
                                <p:commandButton oncomplete="dlgeliminar.show()" icon="b-delete" action="#{creditoBean.cargarOcup()}">
                                    <f:setPropertyActionListener target="#{creditoBean.objocup}" value="#{ocups}" />                                    
                                </p:commandButton>
                            </p:column>
                        </p:dataTable>
                        <p:commandButton value="Agregar ingresos" icon="b-add" oncomplete="dlginsertar.show()" disabled="#{creditoBean.disableGuardar()}"
                                         actionListener="#{creditoBean.limpiarIngreso()}"/>                       
                    </p:tab>
                </p:accordionPanel>
            </h:form>
        </f:view>
        <h:form id="formOcupacion">
            <p:dialog  id="dlg1" header="Ingresar datos" showEffect="explode" hideEffect="explode" widgetVar="dlginsertar" modal="true" >
                <p:panelGrid columns="4">
                    <p:outputLabel value="Tipo:" for="cmbtipo"/>
                    <p:selectOneMenu id="cmbtipo" value="#{creditoBean.objocup.tipo}" required="true" requiredMessage="Seleccione Tipo de Ingreso">
                        <f:selectItem itemLabel="-Seleccione-" itemValue="#{null}" />
                        <f:selectItem itemLabel="Dependiente" itemValue="DP" />
                        <f:selectItem itemLabel="Independiente" itemValue="IN" />
                        <p:ajax update="opcbol opcfacbol opcrrhh opccons opctprop opclic opcsunat" listener="#{creditoBean.actualizar()}" process="@this" />
                    </p:selectOneMenu>
                    <p:outputLabel value="Seleccione:" for="cmbclase"/>
                    <p:selectOneMenu id="cmbclase" value="#{creditoBean.objocup.clase}" required="true" requiredMessage="Seleccione Tipo">
                        <f:selectItem itemLabel="-Seleccione-" itemValue="#{null}" />
                        <f:selectItem itemLabel="Formal" itemValue="FR" />
                        <f:selectItem itemLabel="Informal" itemValue="IF" />
                        <p:ajax update="opcbol opcfacbol opcrrhh opccons opctprop opclic opcsunat" listener="#{creditoBean.actualizar()}" process="@this" />
                    </p:selectOneMenu>
                    <p:outputLabel value="Descripción:" for="txtdesc"/>
                    <p:inputText id="txtdesc" value="#{creditoBean.objocup.descripcion}" onkeyup="javascript:this.value = this.value.toUpperCase();" required="true" requiredMessage="Ingrese Descripción"/>
                    <p:outputLabel value="Empresa:" for="txtem"/>
                    <p:inputText id="txtem" value="#{creditoBean.objocup.empresa}" onkeyup="javascript:this.value = this.value.toUpperCase();" required="true" requiredMessage="Ingrese Descripción"/>
                    <p:outputLabel value="Monto ingresos:" for="txtmonto"/>
                    <p:inputText id="txtmonto" value="#{creditoBean.objocup.montoin}" class="money" required="true" requiredMessage="Ingrese Monto"/>
                    <p:outputLabel value="Constancia posesión:" for="opccons"/>
                    <p:selectOneRadio id="opccons" value="#{creditoBean.objocup.constancia}" disabled="#{creditoBean.opccons}" requiredMessage="Seleccione una opción">
                        <f:selectItem itemLabel="SI" itemValue="true"/>
                        <f:selectItem itemLabel="NO" itemValue="false"/>                        
                    </p:selectOneRadio>
                    <p:outputLabel value="Boletas de pago:" for="opcbol"/>
                    <p:selectOneRadio id="opcbol" value="#{creditoBean.objocup.boletas}" disabled="#{creditoBean.opcbol}" requiredMessage="Seleccione una opción">
                        <f:selectItem itemLabel="SI" itemValue="true"/>
                        <f:selectItem itemLabel="NO" itemValue="false"/>                        
                    </p:selectOneRadio>
                    <p:outputLabel value="Fact/Bol:" for="opcfacbol"/>
                    <p:selectOneRadio id="opcfacbol" value="#{creditoBean.objocup.facbol}" disabled="#{creditoBean.opcfacbol}" requiredMessage="Seleccione una opción">
                        <f:selectItem itemLabel="SI" itemValue="true"/>
                        <f:selectItem itemLabel="NO" itemValue="false"/>                        
                    </p:selectOneRadio>
                    <p:outputLabel value="RRHH:" for="opcrrhh"/>
                    <p:selectOneRadio id="opcrrhh" value="#{creditoBean.objocup.rrhh}" disabled="#{creditoBean.opcrrhh}" requiredMessage="Seleccione una opción">
                        <f:selectItem itemLabel="SI" itemValue="true"/>
                        <f:selectItem itemLabel="NO" itemValue="false"/>                        
                    </p:selectOneRadio>                    
                    <p:outputLabel value="Tarjeta propiedad:" for="opctprop"/>
                    <p:selectOneRadio id="opctprop" value="#{creditoBean.objocup.tpropiedad}" disabled="#{creditoBean.opctprop}" requiredMessage="Seleccione una opción">
                        <f:selectItem itemLabel="SI" itemValue="true"/>
                        <f:selectItem itemLabel="NO" itemValue="false"/>                        
                    </p:selectOneRadio>
                    <p:outputLabel value="Licencia:" for="opclic"/>
                    <p:selectOneRadio id="opclic" value="#{creditoBean.objocup.licencia}" disabled="#{creditoBean.opclic}" requiredMessage="Seleccione una opción">
                        <f:selectItem itemLabel="SI" itemValue="true"/>
                        <f:selectItem itemLabel="NO" itemValue="false"/>                        
                    </p:selectOneRadio>
                    <p:outputLabel value="Pagos sunat:" for="opcsunat"/>
                    <p:selectOneRadio id="opcsunat" value="#{creditoBean.objocup.pagosunat}" disabled="#{creditoBean.opcsunat}" requiredMessage="Seleccione una opción">
                        <f:selectItem itemLabel="SI" itemValue="true"/>
                        <f:selectItem itemLabel="NO" itemValue="false"/>                        
                    </p:selectOneRadio>                    
                    <p:commandButton actionListener="#{creditoBean.insertarOcupacion(creditoBean.credito.anexo, creditoBean.objocup)}"
                                     value="Guardar" ajax="false"/>
                </p:panelGrid>
            </p:dialog>
        </h:form>
        <h:form id="formEliminar">
            <p:dialog header="Eliminar Ingreso de Cliente" showEffect="explode" hideEffect="explode" 
                      widgetVar="dlgeliminar" modal="true" resizable="false" minWidth="200">
                <h:outputText value="¿Desea eliminar?" />
                <p:commandButton value="Si" actionListener="#{creditoBean.eliminarIngreso(creditoBean.credito.anexo)}" 
                                 ajax="false" oncomplete="dlgeliminar.hide();" />
                <p:commandButton value="No" onclick="dlg2.hide();" />
            </p:dialog>
        </h:form>
    </ui:define>
</ui:composition>
