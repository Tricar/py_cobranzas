<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"                
                template="./../views/template.xhtml">
    <ui:define name="content">
        <h2>Gestión de Créditos</h2>
        <h:form>            
            <p:commandButton action="#{creditoBean.nuevo()}" value="Nuevo Crédito" immediate="true" icon="b-add" update="#{ocupacionBean.limpiarlista()}"/>
        </h:form>
        <h:form>            
            <p:panelGrid columns="2">
                <p:outputLabel value="Ingrese Código de crédito:"/>
                <p:inputText value="#{creditoBean.codigo}"/>                       
                <p:commandButton value="Buscar" actionListener="#{creditoBean.cargarxCodigoCredito()}"
                                 ajax="false"/>
            </p:panelGrid>
        </h:form>
        <h:form id="formMostrar">
            <p:growl id="mensajeGeneral" showDetail="true" sticky="false"/>
            <p:dataTable var="cred" value="#{creditoBean.creditos}" 
                         emptyMessage="No hay nada para mostrar">
                <p:column headerText="Cod.">
                    <h:outputText value="#{cred.liqventa}" />
                </p:column>
                <p:column headerText="Nombres">
                    <h:outputText value="#{cred.anexo.nombres}" />
                </p:column>
                <p:column headerText="Num. Doc.">
                    <h:outputText value="#{cred.anexo.numdocumento}" />
                </p:column>
                <p:column headerText="Tienda">
                    <h:outputText value="#{cred.tienda}">
                        <f:converter converterId="tiendaconverter"/>
                    </h:outputText>
                </p:column>
                <p:column headerText="Empresa">
                    <h:outputText value="#{cred.empresa}">
                        <f:converter converterId="empresaconverter"/>
                    </h:outputText>
                </p:column>
                <p:column headerText="Vehículo">
                    <h:outputText value="#{cred.vehiculo.tipovehiculo}">
                        <f:converter converterId="tvehiculo"/>
                    </h:outputText>
                </p:column>
                <p:column headerText="Monto financiado">
                    <h:outputText value="#{cred.saldo}" />
                </p:column>
                <p:column headerText="Deuda Total">
                    <h:outputText value="#{cred.totaldeuda}" />
                </p:column>
                <p:column headerText="Deuda Actual">
                    <h:outputText value="#{cred.deudactual}" />
                </p:column>
                <p:column headerText="OPERACIONES">
                    <p:commandButton value="V" action="#{creditoBean.cargar(loginbean.usuario)}">
                        <f:setPropertyActionListener target="#{creditoBean.credito}" value="#{cred}" />
                    </p:commandButton>
                    <p:commandButton update=":formVer" icon="b-ver" title="Mostrar" actionListener="#{creditoBean.cargarLetras(cred)}"/>                         
                    <p:commandButton value="R" update=":formRef" oncomplete="dlgrefinanciar.show()" title="Refinanciar">
                        <f:setPropertyActionListener target="#{creditoBean.credito}" value="#{cred}" />
                    </p:commandButton>
                    <p:commandButton icon="b-delete" oncomplete="dlgeliminar.show()" update=":formEliminar" title="Eliminar">
                        <f:setPropertyActionListener target="#{creditoBean.credito}" value="#{cred}" />
                    </p:commandButton>
                    <p:commandButton icon="b-Print" ajax="false" actionListener="#{reportesBean.exportarLiq(cred.liqventa)}" title="Imprimir"/>
                </p:column>
            </p:dataTable>
        </h:form>

        <h:form id="formRef">
            <p:dialog id="dlg3" header="Refinanciar Credito" showEffect="explode" hideEffect="explode" 
                      widgetVar="dlgrefinanciar" modal="true" resizable="false" minWidth="200">
                <p:panelGrid columns="2">
                    <p:outputLabel value="Fecha:" />
                    <p:calendar id="txtfecha" showOn="button" value="#{creditoBean.credito.fechareg}" navigator="true" pattern="dd/MM/yyyy"/>
                    <p:outputLabel value="Deuda Total:"/>
                    <p:inputText value="#{creditoBean.credito.deudactual}" readonly="true"/>
                    <p:outputLabel value="Interés:" />
                    <p:selectOneMenu value="#{creditoBean.crediton.interes}" >                        
                        <f:selectItem itemLabel="2" itemValue='2'/>
                        <f:selectItem itemLabel="3" itemValue='3'/>
                        <f:selectItem itemLabel="4" itemValue='4'/>
                        <f:selectItem itemLabel="5" itemValue='5'/>
                    </p:selectOneMenu>
                    <p:outputLabel value="Nro. Letras:" for="txtletra"/>
                    <p:selectOneMenu id="txtletra" value="#{creditoBean.crediton.nletras}" required="true" requiredMessage="Seleccione numero de letra">
                        <f:selectItem itemLabel="-Seleccione-" itemValue="#{null}"/>                        
                        <f:selectItem itemLabel="2" itemValue='2' />
                        <f:selectItem itemLabel="3" itemValue='3'/>
                        <f:selectItem itemLabel="4" itemValue='4'/>
                        <f:selectItem itemLabel="5" itemValue='5'/>
                        <f:selectItem itemLabel="6" itemValue='6'/>
                        <f:selectItem itemLabel="7" itemValue='7'/>
                        <f:selectItem itemLabel="8" itemValue='8'/>
                        <f:selectItem itemLabel="9" itemValue='9'/>
                        <f:selectItem itemLabel="10" itemValue='10'/>
                        <f:selectItem itemLabel="11" itemValue='11'/>
                        <f:selectItem itemLabel="12" itemValue='12'/>
                    </p:selectOneMenu>                    
                    <p:commandButton actionListener="#{creditoBean.refinanciar()}" value="Refinanciar" oncomplete="dlgrefinanciar.hide()"
                                     update=":formMostrar" icon="b-update"/>
                </p:panelGrid>
            </p:dialog>
        </h:form>

        <h:form id="formEliminar">
            <p:dialog id="dlg2" header="Eliminar Credito" showEffect="explode" hideEffect="explode" 
                      widgetVar="dlgeliminar" modal="true" resizable="false" minWidth="200">
                <h:outputText value="¿Desea eliminar?" />
                <p:commandButton value="Si" actionListener="#{creditoBean.eliminar()}" 
                                 ajax="false" oncomplete="dlgeliminar.hide();" />
                <p:commandButton value="No" onclick="dlg2.hide();" />
            </p:dialog>
        </h:form>
        <hr/>
        <h:form id="formVer">
            <p:dataTable var="letras" value="#{creditoBean.letraslista}" 
                         emptyMessage="No hay nada para mostrar">
                <p:column headerText="Descripcion">
                    <h:outputText value="#{letras.descripcion}"/>
                </p:column>
                <p:column headerText="Saldo Capital">
                    <h:outputText value="#{letras.montoletra}"/>
                </p:column>
                <p:column headerText="Interes">
                    <h:outputText value="#{letras.interes}"/>
                </p:column>
                <p:column headerText="Total Letra">
                    <h:outputText value="#{letras.monto}"/>
                </p:column>
                <p:column headerText="Fecha In.">
                    <h:outputText value="#{letras.fecini}">
                        <f:convertDateTime pattern = "dd/MM/yyyy"/>
                    </h:outputText>
                </p:column>
                <p:column headerText="Fecha Ven.">
                    <h:outputText value="#{letras.fecven}">
                        <f:convertDateTime pattern = "dd/MM/yyyy"/>
                    </h:outputText>
                </p:column>
                <p:column headerText="Saldo Deudor">
                    <h:outputText value="#{letras.saldo}"/>
                </p:column>
                <p:column headerText="Mora">
                    <h:outputText value="#{letras.mora}"/>
                </p:column> 
                <p:column headerText="Dias atraso">
                    <h:outputText value="#{letras.diffdays}"/>
                </p:column> 
                <p:column headerText="Estado">
                    <h:outputText value="#{letras.estado}">
                        <f:converter converterId="letrasconverter"/>
                    </h:outputText>
                </p:column>
                <p:column headerText="N. Deb.">
                    <p:commandButton value="ND" icon="b-add" oncomplete="dlgnotadebito.show()" disabled="#{letras.mora == '0.00' or letras.descripcion == 'ND'}"
                                     actionListener="#{creditoBean.cargarLetra(letras)}" />
                </p:column>
            </p:dataTable>            
        </h:form>
        <h:form id="formNotadebito">
            <p:dialog id="dlg4" header="Ingrese los datos" showEffect="explode" hideEffect="explode" 
                      widgetVar="dlgnotadebito" modal="true" resizable="true" minWidth="200">
                <p:panelGrid columns="2">
                    <p:outputLabel value="Fecha:" for="txtfechai"/>
                    <p:calendar id="txtfechai" navigator="true" showOn="button" value="#{creditoBean.letra.fecini}" 
                                pattern="dd/MM/yyyy" required="true" requiredMessage="Ingrese Fecha">                        
                    </p:calendar>
                    <p:outputLabel value="Monto:" for="txtmonto"/>
                    <p:inputText id="txtmonto" value="#{creditoBean.letra.monto}" class="money" required="true" requiredMessage="Ingrese Monto"/>
                    <p:outputLabel value="Referencia:" for="txtref"/>
                    <p:inputText id="txtref" value="#{creditoBean.descND}" required="true" requiredMessage="Ingrese Referencia"/>
                    <p:commandButton actionListener="#{creditoBean.insertarNotaDebito()}" value="Guardar" 
                                     oncomplete="dlgnotadebito.hide()" ajax="false"/>
                </p:panelGrid>
            </p:dialog>
        </h:form>
    </ui:define>
</ui:composition>
